<!DOCTYPE html>
<html>

<head>
  <title>leaves-table</title>
  <meta charset="utf-8">
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <script type="text/javascript" src='js/jquery.min.js'></script>
  <script type="text/javascript" src='js/bootstrap.min.js'></script>
  <!-- bootstrap table-->

  <link rel="stylesheet" href="module/bootstrap-table/bootstrap-table.min.css">
  <link rel="stylesheet" href="module/bootstrap-editable/css/bootstrap-editable.css">
  <script type="text/javascript" src='module/bootstrap-editable/js/bootstrap-editable.min.js'></script>
  <script type="text/javascript" src='module/bootstrap-table/bootstrap-table.min.js'></script>
  <script type="text/javascript" src='module/bootstrap-table/extensions/editable/bootstrap-table-editable.js'></script>
  <script type="text/javascript" src='module/bootstrap-table/locale/bootstrap-table-zh-CN.js'></script>
</head>

<body>
  <div class="container">
    <h1>Resizable</h1>
    <button onclick="addRow()">增加</button>
    <table id="table">
    </table>
  </div>
  <script type="text/javascript">
    var data = [{
        "id": 0,
        "name": "Item 0",
        "price": "$0",
        "amount": 3
      },
      {
        "id": 1,
        "name": "Item 1",
        "price": "$1",
        "amount": 4
      },
      {
        "id": 2,
        "name": "Item 2",
        "price": "$2",
        "amount": 8
      },
      {
        "id": 3,
        "name": "Item 3",
        "price": "$3",
        "amount": 2
      },
      {
        "id": 4,
        "name": "Item 4",
        "price": "$4",
        "amount": 90
      },
      {
        "id": 5,
        "name": "Item 5",
        "price": "$5",
        "amount": 2
      },
      {
        "id": 6,
        "name": "Item 6",
        "price": "$6",
        "amount": 3
      },
      {
        "id": 7,
        "name": "Item 7",
        "price": "$7",
        "amount": 7
      },
      {
        "id": 8,
        "name": "Item 8",
        "price": "$8",
        "amount": 39
      },
      {
        "id": 9,
        "name": "Item 9",
        "price": "$9",
        "amount": 78
      },
      {
        "id": 10,
        "name": "Item 10",
        "price": "$10",
        "amount": 30
      },
      {
        "id": 11,
        "name": "Item 11",
        "price": "$11",
        "amount": 32
      },
      {
        "id": 12,
        "name": "Item 12",
        "price": "$12",
        "amount": 12
      },
      {
        "id": 13,
        "name": "Item 13",
        "price": "$13",
        "amount": 76
      },
      {
        "id": 14,
        "name": "Item 14",
        "price": "$14",
        "amount": 10
      },
      {
        "id": 15,
        "name": "Item 15",
        "price": "$15",
        "amount": 9
      },
      {
        "id": 16,
        "name": "Item 16",
        "price": "$16",
        "amount": 8
      },
      {
        "id": 17,
        "name": "Item 17",
        "price": "$17",
        "amount": 1
      },
      {
        "id": 18,
        "name": "Item 18",
        "price": "$18",
        "amount": 99
      },
      {
        "id": 19,
        "name": "Item 19",
        "price": "$19",
        "amount": 100
      },
      {
        "id": 20,
        "name": "Item 20",
        "price": "$20",
        "amount": 109
      }
    ];
    $.tableConfig = {
      // url: '/Interface/GetData', //请求后台的URL（*）
      // method: 'get', //请求方式（*）
      // toolbar: '#toolbar', //工具按钮用哪个容器
      data: data,
      editable: true, //是否开启编辑模式
      striped: true, //是否显示行间隔色
      cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
      pagination: true, //是否显示分页（*）
      showPaginationSwitch: true, // 是否显示"所有数据/分页数据切换"按钮
      sortable: true, //是否启用排序
      sortOrder: "asc", //排序方式
      showToggle: true, //是否显示详细视图和列表视图的切换按钮
      // height: 500, //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
      // queryParams: oTableInit.queryParams, //传递参数（*）
      sidePagination: "client", //分页方式：client客户端分页，server服务端分页（*）
      pageNumber: 1, //初始化加载第一页，默认第一页
      pageSize: 10, //每页的记录行数（*）
      pageList: [10, 25, 50, 100], //可供选择的每页的行数（*）
      search: true, //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
      // contentType: "application/x-www-form-urlencoded",
      // uniqueId: 'index', //将index列设为唯一索引
      strictSearch: true,
      showColumns: true, //是否显示所有的列
      showRefresh: true, //是否显示刷新按钮
      minimumCountColumns: 2, //最少允许的列数
      clickToSelect: true, //是否启用点击选中行
      // height: 700, //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
      showToggle: false, //是否显示详细视图和列表视图的切换按钮
      cardView: false, //是否显示详细视图
      detailView: false, //是否显示父子表
      paginationPreText: "<<",
      paginationNextText: ">>",
      columns: [{
          field: 'id',
          title: 'ID1',
          align: 'center'
        }, {
          field: 'name',
          title: '名字',
          align: 'center',
          formatter: function (value, row, index) {
            return value + "suffix";
          },
          editable: {
            type: 'text',
            title: '名字',
            validate: function (v) {
              if (!v) return '用户名不能为空';
            }
          }
        }, {
          field: 'price',
          title: '价格',
          sortable: true,
          align: 'center',
          sorter: priceSort,
          visible: false,
          editable: {
            type: 'text',
            title: 'Item Price',
            mode: 'inline', //编辑框的模式：支持popup和inline两种模式，默认是popup
            validate: function (value) {
              value = $.trim(value);
              if (!value) {
                return 'This field is required';
              }
              if (!/^\$/.test(value)) {
                return 'This field needs to start width $.'
              }
              // Get the loaded data of table
              var data = $table.bootstrapTable('getData'),
                //获取已添加到 div 元素的数据
                index = $(this).parents('tr').data('index');
              console.log(data[index]);
              return '';
            }
          }
        },
        {
          field: 'amount',
          title: 'amount1',
          align: 'center',
          sortable: true,
          valign: 'middle',
          rowspan: 1,
          sorter: nameSort,
          editable: {
            type: 'select',
            title: '部门',
            source: function () {
              var result = [];
              $.ajax({
                url: '/getData',
                async: false,
                type: "get",
                data: {},
                success: function (data, status) {
                  $.each(data, function (key, value) {
                    result.push({
                      value: value.ID,
                      text: value.Name
                    });
                  });
                }
              });
              return result;
            }
          }
        },
        {
          field: 'operate',
          title: '操作1',
          align: 'center',
          formatter: operateFormatter,
          events: operateEvents,
        },
      ],
      onEditableSave: function (field, row, oldValue, $el) {
        console.log(row);
        $.ajax({
          type: "post",
          url: "/Editable/Edit",
          data: row,
          dataType: 'JSON',
          success: function (data, status) {
            if (status == "success") {
              alert('提交数据成功');
            }
          },
          error: function () {
            alert('编辑失败');
          },
          complete: function () {}
        });
      },
    };
    $("#table").bootstrapTable($.tableConfig);

    // The context (this) is the column Object. The cell formatter function
    function operateFormatter(value, row, index, field) {
      return [
        '<a class="like" href="javascript:void(0)" title="Like" id="like">',
        '<i class="glyphicon glyphicon-heart"></i>',
        '</a>  ',
        '<a class="remove" href="javascript:void(0)" title="Remove" id="remove">',
        '<i class="glyphicon glyphicon-remove" onclick="delRow(' + row['id'] + ')"></i>',
        '</a>'
      ].join('');
    }

    // Object The cell events listener when you use formatter function
    var operateEvents = {
      'click .like': function (e, value, row, index) {
        console.log(1);
        alert('You click like action, row: ' + JSON.stringify(row));
      },
      'click .remove': function (e, value, row, index) {
        $table.bootstrapTable('remove', {
          field: 'id',
          values: [row.id]
        });
      }
    };

    // 自定义名字排序
    function nameSort(a, b) {
      a = parseInt(a.slice(4));
      b = parseInt(b.slice(4));
      if (a > b) return 1;
      if (a < b) return -1;
      return 0;
    }

    //自定义价格排序 
    function priceSort(a, b) {
      a = parseInt(a.slice(1));
      b = parseInt(b.slice(1));
      if (a > b) return 1;
      if (a < b) return -1;
      return 0;
    }

    function addRow() {
      var count = $('#table').bootstrapTable('getData').length;
      // newFlag == 1的数据为新规的数据
      $('#table').bootstrapTable('insertRow', {
        index: 0,
        row: {
          proName: '',
          proNo: '',
          property: '',
          total: '',
          unit: '',
          totalAmount: '',
          remarks: ''
        }
      });
    }

    function delRow(id) {
      var r = confirm("是否删除该条信息");
      if (r) {
        $.ajax({
          type: "GET",
          url: GetRootName() + '/Project/Project/DelPower',
          data: {
            ID: id
          },
          dataType: "json",
          cache: false,
          async: false,
          success: function (data) {
            $("#powerTable").bootstrapTable('remove', {
              field: 'ID',
              value: id
            });
          }
        });
      }
    }
  </script>
</body>

</html>